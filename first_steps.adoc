First steps: ``Hello web'' in Opa
----------------------------------

[icons=None, caption="Summary"]
[NOTE]
=======================
You will learn:

* A bit about Opa's syntax
* Basics of HTML manipulation in Opa.
* Basics of main entry points of Opa programs.
* How to compile your first Opa program.
* How to deploy it (also on many machines).
=======================

Ok, if you heard my <<chapter_hello_opa, previous bragging>> about how great
Opa is and what it can do to make your life (as a web developer) easier, then
you are probably curious to see it in action. I have to admit there won't be
too much action in this post, but hey, we need to start with the basics and
the sooner we are done with it the faster we will be able to move to more
interesting stuff. Right? Ok, so, shall we start?

The simplest Opa program
~~~~~~~~~~~~~~~~~~~~~~~~

Here it is:
[source, opa]
------------------------
server = Server.one_page_server("Hello", ( -> <>Hello web</>))
------------------------

That's the web equivalent of the infamous
http://en.wikipedia.org/wiki/Hello_world[``Hello world'' program],
only this program instead of printing ``Hello world'' on the console
creates a static web-page with title ``Hello'' and ``Hello web'' as
its content (actually, it does much more than that, but we will come
to that in a second).

Ok, now let us take this program apart and introduce some basics
of Opa along the way.

Functions in Opa
~~~~~~~~~~~~~~~~
First, let's rewrite the above program into:

[source, opa]
------------------------
page() = <>Hello web</>
server = Server.one_page_server("Hello", page)
------------------------

This program consists of two declarations: a function +page+ and
a special declaration +server+ (which we will come to in a few
moments). A general syntax of a function is as follows:

[source, opa]
------------------------
my_fun(arg1: type1, ..., argN: typeN) : ret_type = <fun_body>
------------------------

It declares a function called +my_fun+ with +N+ arguments with
given names. The return type of the function is +ret_type+.
We will say that the type of this function is:
+type1, ..., typeN -> ret_type+.

Note that all the type annotations can be usually omitted,
as the types will be inferred by the compiler (however,
explicitly stating types can often improve readability
and maintainability of programs).

[TIP]
.Types in Opa
========================
_Types_ are very important in Opa, which is a
http://en.wikipedia.org/wiki/Strongly_typed[``strongly-typed''] language.
The main advantage of a strong, static type system is that many mistakes
are caught by the compiler.
=======================

Now, the function declaration of +page+ that we saw earlier is just a
special case of this constructions, with an empty list of arguments.

But what was this funny arrow (+->+) in the first listing? Well, that's
a notation for anonymous functions in Opa.

[source, opa]
------------------------
(x, y -> ...)
------------------------

is a function with two arguments +x+ and +y+ and in the first listing
the list of function arguments is empty.


(X)HTML in Opa
~~~~~~~~~~~~~~

Ok, so we know that the expression below denotes a function with no
arguments.

[source, opa]
------------------------
( -> <>Hello web</>)
------------------------

But what is the body of this function? Well, that's a special XHTML
syntax in Opa. Probably it would look more familiar if instead we
wrote:

[source, opa]
------------------------
( ->  <span>Hello web</span>)
------------------------

Opa allows to omit names in the closing tags. So instead of:

[source, opa]
------------------------
<span>Hello web</span>
------------------------

you can write:

[source, opa]
------------------------
<span>Hello web</>
------------------------

It is one of many examples showing how Opa lets you decide what's best.
You think that having the name in the closing tags improves readability?
Be our guest, include them. You'd rather save some keystrokes? That's
fine too, +</>+ will close the most recently opened tag.

But there is something much more important than the syntax, happening
here. X(HT)ML is a data-type in Opa. It's important, so let me repeat,
this time louder: *X(HT)ML is a data-type in Opa*. Pretty much like
strings.

What does it mean in practice? ...

For instance let us write a (trivial) function to concatenate two
XHTML fragments:

[source, opa]
------------------------
xhtml_concat(x1 : xhtml, x2 : xhtml) : xhtml =
  <>{x1}{x2}</>
------------------------

or if you'd rather omit types:

[source, opa]
------------------------
xhtml_concat(x1, x2) = <>{x1}{x2}</>
------------------------

what we use here is the mechanism of _inserts_ of Opa, which allows us
to easily (and safely) insert values intro strings and XHTML fragments.
For instance compare Opa:

[source, opa]
------------------------
print("{x} + {y} = {x+y}")
------------------------

and Java:

[source, java]
------------------------
System.out.println(x + " + " + y + " = " + (x + y))
------------------------

or

[source, java]
------------------------
System.out.printf("%d + %d = %d", x, y, x+y)
------------------------

Let me conclude this section with a small snippet that
hopefully does not require any comment by now:

[source, opa]
------------------------
mk_entry(css_class, header, content) =
  <div class={css_class}>
    <span class="header">{header}</>
    <span class="content">{content}</>
  </>
------------------------

Entry points in Opa
~~~~~~~~~~~~~~~~~~~

If you run a program in Java, C++ or C# its +main+ method
will be called. What happens when you run an Opa program?

Opa is designed for the web. A compiled Opa program is
going to function as a web server. The special top-level
+server+ value declares such a server (in fact, as we'll
see later, there can be more than one such declaration).

Our ``Hello web'' program uses a very simple variant of a
web-server, that just serves one single page (more
realistic services will usually consist of a multitude
of pages), created by +Server.one_page_server+ function with
two arguments: page title (+string+) and page body
(+-> xhtml+, i.e. a function with no arguments and
a return value of type +xhtml+).

[source, opa]
------------------------
Server.one_page_server : string, ( -> xhtml) -> service
------------------------

[icons=None, caption="Exercise"]
[NOTE]
=======================
(*) Take a look at online browsable
http://opalang.org/resources/doc/index.html[OPA API]
and find the declaration for +Server.one_page_server+.
Read the documentation. What are other ways of creating
a server in Opa?
=======================

Compiling the program
~~~~~~~~~~~~~~~~~~~~~

[CAUTION]
=======================
I'm assuming here that you have Opa installed on your
machine. If that's not the case please follow
http://opalang.org/resources/book/index.html#Getting_Opa[the instructions]
in the manual.
=======================
